<!DOCTYPE html>
<html>
<head>
<title>회원가입</title>
<meta charset="UTF-8">
<link href="../../css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../../css/main.css">
<link href="http://fonts.googleapis.com/earlyaccess/nanumgothic.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
<!--file input  -->
<link href="../../node_modules/bootstrap-fileinput/css/fileinput.css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" media="all" rel="stylesheet" type="text/css"/>
<link href="../../node_modules/bootstrap-fileinput/themes/explorer-fa/theme.css" media="all" rel="stylesheet" type="text/css"/>
<link href="../../css/fileupload.css" rel="stylesheet" type="text/css">
 
<style>
@import url(//fonts.googleapis.com/earlyaccess/notosanskr.css);

strong {
    margin-left: 15%;
    font-size: 15px;
}
 

body, div {
    font-family: 'Noto Sans KR', sans-serif;

}
 
 
</style> 
</head>
<body>

<div class="container">
<div class="form-group row" >
<h1 class="ml-3">회원가입</h1>
</div>
<hr>
</div>

<div class="container">
<form id="form" method="post" enctype="multipart/form-data" autocomplete="off">
<div class="form-group row" >
<div class="col-sm-10">
<input id='act_id' class="form-control" type='text' placeholder="아이디를입력하시오." required name='accountName' >
<p class="mb-0" id="checkId" >
</div>
</div>

<div class="form-group row">
<div class="col-sm-10">
<input id='email' class="form-control" type="email" placeholder="이메일를입력하시오." required name='email'>
<p class="mb-0" id="checkEmail" >
</div>
</div>


<div class="form-group row mb-0">
<div class="col-sm-10">
<input id='pwd' type='password' class="form-control mb-0" placeholder="비밀번호를입력하시오." required name='password'>
</div>
</div>

<div class="form-group row">
<div class="col-sm-10">
<input id="PwCheck" type="password" class="form-control"  required placeholder="비밀번호 재입력." >
<p class="mb-0" id="pwsame">
</div>
</div>

<div class="form-group row">
<div class="col-sm-10">
<input id='name' type='text' class="form-control" placeholder="이름를입력하시오." required name='name'>
</div>
</div>

<div class="form-group row">
<div class="col-sm-10">
<input id='acc_no' type='text' class="form-control" placeholder="계좌번호를입력하시오." name='accountNo'>
</div>
</div>

<div class="form-group row">
<div class="col-sm-10">
<input id='bank' type='text' class="form-control" placeholder="은행명을입력하시오" name='bank'>
</div>
</div>

<div class="form-group row">
<div class="col-sm-10">
<input id='cnt' type='text' class="form-control" placeholder="한마디를 적어주세요" name='comment'>
</div>
</div>

<div class="form-group row">
<div class="col-sm-10">
<input id='phone' type='text' class="form-control" placeholder="전화번호를입력하시오." name='phone'>
</div>
</div>

 <div class="form-group row">
<div class="col-sm-6">
<input type="text" id="sample6_postcode" class="form-control1" placeholder="우편번호" name='postNo'>
</div>
<div class="col-sm-4">
<input class="btn btn-primary col-12" type="button" onclick="sample6_execDaumPostcode()" value="우편번호">
</div>
</div>

 
<div class="form-group row">
<div class="col-sm-10">
<input type="text" id="sample6_address" class="form-control" placeholder="주소를입력하시오."name='baseAddress'>
</div>
</div>

<div class="form-group row">
<div class="col-sm-10">
<input type="text" id="sample6_address2" class="form-control" placeholder="상세주소를입력하시오." name='detailAddress'>
</div>
</div>


<div id="file" class="form-group row">
<div class="col-sm-10">
<input id='file4' name="photo" type="file">
</div>
</div>
       
<div class='form-group row'>
    <button id="addBtn" type="button" class='btn btn-primary mx-auto col-4'>회원가입</button>
</div>

</form>

</div> 

<script src='../../node_modules/jquery/dist/jquery.min.js'></script>
  <!--file input  -->
  <script src="../../node_modules/bootstrap-fileinput/js/plugins/sortable.js" type="text/javascript"></script>
    <script src="../../node_modules/bootstrap-fileinput/js/fileinput.js" type="text/javascript"></script>
    <script src="../../node_modules/bootstrap-fileinput/js/locales/fr.js" type="text/javascript"></script>
    <script src="../../node_modules/bootstrap-fileinput/js/locales/es.js" type="text/javascript"></script>
    <script src="../../node_modules/bootstrap-fileinput/themes/explorer-fa/theme.js" type="text/javascript"></script>
    <script src="../../node_modules/bootstrap-fileinput/themes/fa/theme.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" type="text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" type="text/javascript"></script>

<script src="//developers.kakao.com/sdk/js/kakao.min.js"></script>
<script src="https://static.nid.naver.com/js/naveridlogin_js_sdk_2.0.0.js" charset="utf-8"></script>
<script src='../../node_modules/popper.js/dist/umd/popper.min.js'></script>
<script src='../../node_modules/bootstrap/dist/js/bootstrap.min.js'></script>
<script src="https://ssl.daumcdn.net/dmaps/map_js_init/postcode.v2.js"></script>
<script src='/node_modules/sweetalert/dist/sweetalert.min.js'></script>

<script type="text/javascript">
var pwd = $('#pwd'),
    pwd2 = $('#PwCheck'),
    id = $('#act_id'),
    email = $('#email'),
    nameItem = $('#name'),
    accNo = $('#acc_no'),
    bank = $('#bank'),
    cnt = $('#cnt'),
    phone = $('#phone'),
    postNo = $('#sample6_postcode'),
    baseAddr = $('#sample6_address'),
    detailAddr = $('#sample6_address2'),
    photos = $('#photo'),
    addBtn = $('#addBtn');

$('input').on("blur",function(e) {
    if(e.target.value == "") {
        $(this).addClass('mb-0');
        $(this).siblings().html('<i class="fa fa-exclamation-circle" style="color:red"></i>빈칸을 채워주세요').css('color', 'red');
    }
})

$(document).ready(function(){
    id.keyup(() => {
        $.ajax({
            type: 'POST',
            url: '  ../../json/user/checkId',
            data: {
                "accountName" : id.val()
            },
            success: function(data){
                console.log(data)
                                
                if($.trim(data) == 0){
                    $('#act_id').addClass('mb-0');
                    $('#checkId').html('<i class="fa fa-check" style="color:#21ff00"></i>사용가능').css('color', '#007BFF');
                } else {
                    $('#act_id').addClass('mb-0');
                    $('#checkId').html('<i class="fa fa-exclamation-circle" style="color:red"></i>사용불가').css('color', 'red');
                }
            }   
        });    //end ajax    
    });    //end on  
    
    email.keyup(() => {
        $.ajax({
            type: 'POST',
            url: '  ../../json/user/checkEmail',
            data: {
                "email" : email.val()
            },
            success: function(data){
                console.log(data)
                if($.trim(data) == 0){
                    $('#email').addClass('mb-0');
                    $('#checkEmail').html('<i class="fa fa-check" style="color:#21ff00"></i>사용가능').css('color', '#007BFF');
                } 
                else{
                    $('#email').addClass('mb-0');
                    $('#checkEmail').html('<i class="fa fa-exclamation-circle" style="color:red"></i>사용불가능').css('color', 'red');
                }
            }
        });    //end ajax    
    }); 
    
});

$('#PwCheck').keyup(() => {
    if (pwd.val() == pwd2.val()) {
        $('#PwCheck').addClass('mb-0');
        $('#pwsame').html('<i class="fa fa-check" style="color:#21ff00"></i>일치합니다.').css('color', '#007BFF');
    } else {
        $('#PwCheck').addClass('mb-0');
        $('#pwsame').html('<i class="fa fa-exclamation-circle" style="color:red"></i>비밀번호가 일치하지 않습니다.').css('color', 'red');
    }
});

addBtn.click(() => {
    $(':required').each(function() {
        if ($(this).val() == "") {
            swal("빈칸을 채워주세요");
            throw stop;
        };
    });
    var formData = new FormData($("#form")[0]);
    $.ajax('../../json/user/add', {
        data : formData,
        dataType: 'json',
        method: 'POST',
        processData : false,
        contentType : false,
        success: (result) => {
            $.post('../../json/auth/login', {
                accountName: id.val(),
                password: pwd.val()
                
            }, (result) => {
                if (result.status == "success") {
                    location.href = "../item/list.html"
                }
            },'json');
        },
        error:function(request,status,error){
            swal("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
         }

    });
});


    function sample6_execDaumPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                // 각 주소의 노출 규칙에 따라 주소를 조합한다.
                // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                var fullAddr = ''; // 최종 주소 변수
                var extraAddr = ''; // 조합형 주소 변수

                // 사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
                if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                    fullAddr = data.roadAddress;

                } else { // 사용자가 지번 주소를 선택했을 경우(J)
                    fullAddr = data.jibunAddress;
                }

                // 사용자가 선택한 주소가 도로명 타입일때 조합한다.
                if(data.userSelectedType === 'R'){
                    //법정동명이 있을 경우 추가한다.
                    if(data.bname !== ''){
                        extraAddr += data.bname;
                    }
                    // 건물명이 있을 경우 추가한다.
                    if(data.buildingName !== ''){
                        extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                    }
                    // 조합형주소의 유무에 따라 양쪽에 괄호를 추가하여 최종 주소를 만든다.
                    fullAddr += (extraAddr !== '' ? ' ('+ extraAddr +')' : '');
                }

                // 우편번호와 주소 정보를 해당 필드에 넣는다.
                document.getElementById('sample6_postcode').value = data.zonecode; //5자리 새우편번호 사용
                document.getElementById('sample6_address').value = fullAddr;

                // 커서를 상세주소 필드로 이동한다.
                document.getElementById('sample6_address2').focus();
            }
        }).open();
    }
</script>
<script>
$('#file4').fileinput({
    theme: 'fa',
});

</script>

</body>
</html>
    