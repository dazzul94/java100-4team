<style>
@import url(//fonts.googleapis.com/earlyaccess/notosanskr.css);

body, div {
	font-family: 'Noto Sans KR', sans-serif;
}

body {
    padding-top: 110px !important;
}

.ddd {
	border-color: #a8a8a8;
}

#words {
	font-family: FontAwesome;
}

.m_pointer {
	cursor: pointer;
}

#rent:hover {
	color: #808080;
}

#lend:hover {
	color: #808080;
}

#rentView:hover {
	color: #808080;
}

#lendView:hover {
	color: #808080;
} 
function onSuccess(googleUser) {
      console.log('Logged in as: ' + googleUser.getBasicProfile().getName());
    }
    function onFailure(error) {
      console.log(error);
    }
    function renderButton() {
      gapi.signin2.render('my-signin2', {
        'scope': 'profile email',
        'width': 240,
        'height': 50,
        'longtitle': true,
        'theme': 'dark',
        'onsuccess': onSuccess,
        'onfailure': onFailure
      });
    }

</style>

<meta name="google-signin-scope" content="profile email">
<meta name="google-signin-client_id"
	content="1044303474679-rpsg3ved114h5p6dpdg0tsp6joo2l2la.apps.googleusercontent.com">


<nav class="fixed-top">
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
	<div class="container">
		<i class="fa fa-handshake-o" style="font-size: 24px; color: white"></i>
		<h4 class="mb-0">
			<a onclick="location.href='/html/item/list.html'"
				style="color: white;" class="" href="#">SharerSharee</a>
		</h4>
		<button class="navbar-toggler" type="button" data-toggle="collapse"
			data-target="#navbarColor02" aria-controls="navbarColor02"
			aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="col-auto"></div>
		<div class="collapse navbar-collapse" id="navbarColor02">
			<form action=../item/list.html class="form-inline">
				<input id="words" class="form-control col-sm-10 mb-0" type="search"
					name='words' placeholder="&#xf002" aria-label="Search">
			</form>
			<ul class="navbar-nav ml-auto">
				<li class="nav-item active"><i id="usericon" class="fa fa-user align-middle"
					style="font-size: 24px; color: white"></i> <a id="username" href=""
					onclick="href='../user/view.html'" style="display: inline-block;"
					class="nav-link"></a></li>
					<div class="col-1"></div>
				<li class="nav-item active"><i id="keyicon" style="font-size:24px;color:white;display: inline-block;" class="fa fa-key align-middle"></i>
				<a class="nav-link" id="loginBtn"
					href="" style="display: inline-block;" data-toggle="modal" data-target="#myModal">Login</a>
					<a class="nav-link" id="logoutBtn" href="" style="display: inline-block;">Logout</a> 
				</li>
			</ul>
		</div>
	</div>
</nav>

<nav class="site-header sticky-top border ddd" style="background-color: white;">
	<div class="container">
		<!-- <div style="display: inline-block;"
			onclick="location.href='../item/form.html'"
			class="p-2 bd-highlight m_pointer">
			<i class="fa fa-plus-square" style="color: #007BFF"></i>Add
		</div> -->
		<div class="filter">
            <ul class="filter__list mb-0">
                <li><a id="add" href="#"><i class="fa fa-plus-square" style="color: #007BFF">
                </i>Add</a></li>
                <li><a href="../item/list.html">All</a></li>
                <li><a href="../item/list.html?cr=1">전자제품</a></li>
                <li><a href="../item/list.html?cr=2">뷰티</a></li>
                <li><a href="../item/list.html?cr=3">의류</a></li>
                <li><a href="../item/list.html?cr=4">공구</a></li>
                <li><a href="../item/list.html?cr=5">ETC</a></li>
            </ul>
        </div>
	</div>
</nav>
</nav>


<div class="modal fade" id="myModal" style="display: none;">
	<div class="modal-dialog">
		<div class="modal-content">

			<!-- Modal Header -->
			<div class="modal-header">
				<h4 class="modal-title"></h4>
				<button type="button" class="close" data-dismiss="modal">&times;</button>
			</div>

			<!-- Modal body -->
			<div class="modal-body">

				<form action="login" method='post'>

					<div align="center" class='form-group'>
						<img src="../../img/portfolio/shareicon2.png">
					</div>

					<div class='form-group'>
						<input placeholder="아이디" class='form-control' id='accountName'
							type='text' name='accountName'>
					</div>

					<div class='form-group'>
						<input placeholder="비밀번호" class='form-control' id='password'
							type='password' name='password'>
					</div>

					<div class='form-group'>
						<div class="form-check">
							<input type="checkbox" class="form-check-input"
								id="saveaccountName" name="saveaccountName"> <label
								class="form-check-label" for="saveaccountName">아이디 저장</label>
						</div>
					</div>
					<button id="btn2" type="button"
						class='form-control form-group btn btn-primary'>로그인</button>
				</form>
				<button type="button" onclick="location='../user/form.html'"
					class="form-control form-group btn btn-primary">회원가입</button>
			</div>
			<div id="fb" align="center" class="fb-login-button" data-width="222"
				data-max-rows="1" data-size="large" data-button-type="login_with"
				data-show-faces="false" data-auto-logout-link="false"
				data-use-continue-as="false" data-scope="public_profile,email"
				data-onlogin="checkLoginState()"></div>
				
			<div align="center" class='form-group'>
				<a id="kakao-login-btn"></a>
			</div>
			<div align="center" class='form-group'>
				<a id="naverIdLogin_loginButton" href="#" role="button"><img
					src="https://static.nid.naver.com/oauth/big_g.PNG" width="222"
					height="49"></a>
			</div>
			<div align="center" class="form-group g-signin2"
				data-onsuccess="onSignIn"></div>
		    <div id="my-signin2"></div>
				
			<!-- Modal footer -->
			<div class="modal-footer">
				<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
			</div>

		</div>
	</div>
</div>
<script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script>
<script src='/node_modules/sweetalert/dist/sweetalert.min.js'></script>
<script type="text/javascript">

function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
    var expires = "expires="+d.toUTCString();
    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}

function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
        }
    }
    return "";
}
 
$('#add').click(() => {
    $.getJSON('/json/auth/loginUser', function(result) {
            if (result.status == "fail"){
                swal("로그인이 필요한 페이지 입니다.").then((value) => {
                    $('#loginBtn').click()
                })
                return;
            }
            location.href="/html/item/form.html"
        })
        
})

</script>

<script type="text/javascript">
var id = $('#accountName'),
    pwd = $('#password'),
    loginBtn = $('#btn2'),
    saveId = $('#saveaccountName');
    if (getCookie('check') == 'ok') {
        saveId.prop("checked", true);
    }
    id.val(getCookie('id'));
    

    
loginBtn.click(() => {
    
    console.log(id.val(), pwd.val(),saveId.is(':checked'));
    if (saveId.is(':checked')) {
        setCookie('check','ok',7);
        setCookie('id', id.val(), 7);
    } else {
        setCookie('check',"",0);
        setCookie('id',"", 0);
    }
    
    $.post('../../json/auth/login', {
        accountName: id.val(),
        password: pwd.val()
        
    }, (result) => {
        if (result.status == "success") {
            location.reload();
            
        } else {
            alert('이메일이나 암호가 일치하는 사용자를 찾을 수 없습니다.!')
        }
    },'json');
  
    
});

var logined = false;
window.onbeforeunload = function(e){
	  gapi.auth2.getAuthInstance().signOut();
	};
$('#logoutBtn').hide();
$('#usericon').hide();
$.ajax('/json/auth/loginUser', {
    beforeSend: function(xmlHttpRequest) {
        xmlHttpRequest.setRequestHeader("AJAX", "true");
    },
    dataType: 'json',
    success: (result) => {
        $('#username').html(result.account.name);
        $('#loginBtn').hide();
        $('#logoutBtn').show();
        $('#usericon').show();
        $('#keyicon').removeClass('fa fa-key').addClass('fa fa-unlock-alt');
        logined = true;
        $(document.body).trigger('login', {'status': 'success'});
    },
    error: function(e) {
        if (e.status == 401) {
            location.href = '../auth/loginform.html';
        }
    }
});     

$('#logoutBtn').click(() => {
    $.getJSON('../../json/auth/logout', (result) => {
        var link = document.location.href;
        if(link.indexOf("/user/view.html") >= 0) {
             location.href = '../item/list.html';
            } else if(link.indexOf("/tr/list.html") >= 0) {
                location.href = '../item/list.html';    
            } else if(link.indexOf("/msg/list.html") >= 0) {
                location.href = '../item/list.html';
            } else if(link.indexOf("/item/form.html") >= 0) {
                location.href = '../item/list.html';
            } else {
                location.reload(true);
            }
    });
})

/* 
$('#username').click(() => {  
    $.getJSON('../../json/auth/loginUser', function(result){
        if (result.status != "fail")        
            location.href="../user/view.html?no=" + result.account.accountsNo
    }
)}); */

function onSignIn(googleUser) {
    // The ID token you need to pass to your backend:
    if(!logined) {
	    var id_token = googleUser.getAuthResponse().id_token;
	    $.getJSON(
	            '../../json/auth/googleLogin', 
	            {'accessToken': id_token}, 
	            function(result) {
	              if (result.status == 'success') {
	            	  
	                  location.href = '../item/list.html';
	              } else {
	                  window.alert('로그인 실패입니다!');
	              }
	        });
    }
  };


function autoServerLogin(accessToken) {
    $.getJSON(
        '../../json/auth/facebookLogin', 
        {'accessToken': accessToken}, 
        function(result) {
          if (result.status == 'success') {
              location.href = '../item/list.html';
          } else {
              window.alert('로그인 실패입니다!');
          }
    });
}

function statusChangeCallback(response) {
  console.log(response);

  if (response.status === 'connected') { // 로그인이 정상적으로 되었을 때,
      autoServerLogin(response.authResponse.accessToken);
  
  } else { // 로그인이 되지 않았을 때,
      console.log("로그인 되지 않았음");
  }
}
  
function checkLoginState() {
    FB.getLoginStatus(function(response) { 
      statusChangeCallback(response);
    });
}

window.fbAsyncInit = function() {
  FB.init({
    appId      : '1658829817493258', // 개발자가 등록한 앱 ID
    cookie     : true,  
    xfbml      : true,  
    version    : 'v2.12' 
  });
};

(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "https://connect.facebook.net/en_US/sdk.js";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));


Kakao.init("63ef3befe6185210578175ae33f57f48");
Kakao.Auth.createLoginButton({
    container: '#kakao-login-btn',
    success: function(authObj) {
          console.log(authObj.access_token)
          $.getJSON(
                  '../../json/auth/kakaoLogin', 
                  {'accessToken': authObj.access_token}, 
                  function(result) {
                      console.log(result)
                    if (result.status == 'success') {
                        location.href = '../item/list.html';
                    } else {
                        window.alert('로그인 실패입니다!');
                    }
              });
    }
    });

var naverLogin = new naver.LoginWithNaverId(
        {
            clientId: "ci2uARbrUgEbOCNv2VE7",
            callbackUrl: "http://t4.java100.com:9999/html/auth/callback.html",
            isPopup: false,
            callbackHandle: true,
        }
    );
    /* (4) 네아로 로그인 정보를 초기화하기 위하여 init을 호출 */
naverLogin.init();




</script>
