<!DOCTYPE html>
<html>
<head>
<title>물품 등록</title>
<meta charset='UTF-8'>
<link href="../../css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../../css/main.css">
<link href="http://fonts.googleapis.com/earlyaccess/nanumgothic.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
<!--file input  -->
<link href="../../node_modules/bootstrap-fileinput/css/fileinput.css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" media="all" rel="stylesheet" type="text/css"/>
<link href="../../node_modules/bootstrap-fileinput/themes/explorer-fa/theme.css" media="all" rel="stylesheet" type="text/css"/>
<link href="../../css/fileupload.css" rel="stylesheet" type="text/css">

<style type="text/css">
</style>


</head>
<body>
<header>  
       
    </header>

<!-- <div class='container'>
<div class="d-flex justify-content-start bd-highlight mb-3">
   <div class="p-2 bd-highlight m_pointer mx-auto" id="rentView"><i id="rticon" class="fa fa-sign-out" style="color:#007BFF;font-size:36px;"></i>
    <h3 style="display: inline-block;"><span>Rent</span></h3></div>
    <div class="p-2 bd-highlight m_pointer mx-auto" id="lendView"><i id="ldicon" class="fa fa-sign-in" style="color:grey;font-size:36px;"></i>
    <h3 style="display: inline-block;"><span>Lend</span></h3></div> 
    </div>
</div> -->

<div class="container">
<div class="row">
<div class="mx-auto pt-3 col-11">
<form id='formData' method="post" enctype="multipart/form-data" onsubmit="event.preventDefault()">
<input type="hidden" id='status' name='status' value=0> <!-- status 0은 그냥 등록상태 1은 대여상태 -->
        
        <table class="table table-bordered">
            <tbody>
                <tr>
                    <th style="background-color: #f3f3f3;" class="text-center" colspan="2">
                        <select id='category' class="btn btn-secondary data-reset" name="category"><option value=0>카테고리</option>
						    <option value=1>전자제품</option>
						    <option value=2>뷰티/악세</option>
						    <option value=3>의류</option>
						    <option value=4>공구</option>
						    <option value=5>ETC</option>
						    </select>
                     </th>
                </tr>
               
                <tr>
                    <th style="background-color: #f3f3f3;" class="text-center"
                        rowspan="2">거래방법</th>
                </tr>
                <tr>
                    <td style="background-color: white;" class="text-muted"><span>직거래&nbsp;</span><input class='data-pay' type="checkbox" value=1>
            <span>안전거래&nbsp;</span><input class='data-pay' type="checkbox" value=2>
            <input id='payYn' name="directOrPay" type="hidden" value=0></td>
                </tr>

                <tr>
                    <th style="background-color: #f3f3f3;" class="text-center"
                        rowspan="2">물품정보</th>
                </tr>
                <tr>
                    <td style="background-color: white;" class="text-muted"><input id='itemName' class="form-control data-reset" type="text" placeholder="물품정보를 입력하세요" name='itemName'></td>
                </tr>

                <tr>
                    <th style="background-color: #f3f3f3;" class="text-center"
                        rowspan="2">제목</th>
                </tr>
                <tr>
                    <td style="background-color: white;" class="text-muted"><input id='title' type='text' class="form-control data-reset" placeholder="제목을 입력하세요" name='title'></td>
                </tr>

                <tr>
                    <th style="background-color: #f3f3f3;" class="text-center"
                        rowspan="2">내용</th>
                </tr>
                <tr>
                    <td style="background-color: white;" class="text-muted"><textarea id='content' class="form-control data-reset" placeholder="내용을 입력하세요"  name='content'>
                    </textarea></td>
                </tr>

                <tr>
                    <th style="background-color: #f3f3f3;" class="text-center"
                        rowspan="2">기간</th>
                </tr>
                <tr>
                    <td style="background-color: white;" class="text-muted"><input style="width:200px; display: inline-block" id='startDate' type='date' 
        class="form-control data-reset" placeholder="시작일" name='startDate'>
 
        <input style="width:200px; display: inline-block" id='endDate' type='date' 
        class="form-control data-reset" placeholder="종료일" name='endDate'></td>
                </tr>
                <tr>
                    <th style="background-color: #f3f3f3;" class="text-center"
                        rowspan="2">가격</th>
                </tr>
                <tr>
                    <td style="background-color: white;" class="text-muted"><input id='price' type='number' class="form-control data-reset" placeholder="쉐어비용을 입력하세요" name='price'></td>
                </tr>

                <tr>
                    <th style="background-color: #f3f3f3;" class="text-center"
                        rowspan="2">사진</th>
                </tr>
                <tr>
                    <td style="background-color: white;" class="text-muted"><input id='file4' name="photo" type="file" multiple ></td>
                </tr>
                
                <tr>
                    <th style="background-color: #f3f3f3;" class="text-center"
                        rowspan="3">거래장소 지정</th>
                </tr>
                <tr>
                    <td style="background-color: white;" class="text-muted">
                    <div id="map" style="width:300px;height:300px;margin:0 20px"></div>
                    
                    </td>
                </tr>
                <tr>
                    <td style="background-color: white;" class="text-muted">
		                <input id="address" style="display:inline-block;width:250px;margin:auto 10px;" type="text" placeholder="주소를 입력하세요">
		                <input id="submit" class='btn' type="button" value="위치 검색">
		                <input id="myaddr" class='btn' type="button" value="내 주소 입력">
		                <div style="padding-left:15px;color:#3c8ce8;font-size: 0.8em">* 주소검색이 안될시 동단위로 검색후 상세 위치는 마우스 클릭으로 지정하세요</div>

                         <input id='itemAddr' type="hidden" name='dealAddress' value='0'>
                         <input id='mapAddr' type="hidden" name='address' value='0'>
                         <input id='lat' type="hidden" name='latitude' value=0>
                         <input id='lng' type="hidden" name='longitude' value=0>
                    </td>
                </tr>
            </tbody>
        </table>
            </form>
    </div>
    </div>
        <div class="textcenter">
            <button id="addBtn" type="button" class="btn btn-primary">등록</button>
        </div><br><br><br><br><br><br><br><br><br>
</div>

<script src="//developers.kakao.com/sdk/js/kakao.min.js"></script>
<script src="https://static.nid.naver.com/js/naveridlogin_js_sdk_2.0.0.js" charset="utf-8"></script>
<script src='../../node_modules/moment/moment.js'></script>
<script src='../../node_modules/jquery/dist/jquery.min.js'></script>
<script src='../../node_modules/popper.js/dist/umd/popper.min.js'></script>
<script src='../../node_modules/bootstrap/dist/js/bootstrap.min.js'></script>
<script src='/node_modules/sweetalert/dist/sweetalert.min.js'></script>
<script src='/js/fileupload.js'></script>
<!-- file input -->
 <script src="../../node_modules/bootstrap-fileinput/js/plugins/sortable.js" type="text/javascript"></script>
    <script src="../../node_modules/bootstrap-fileinput/js/fileinput.js" type="text/javascript"></script>
    <script src="../../node_modules/bootstrap-fileinput/js/locales/fr.js" type="text/javascript"></script>
    <script src="../../node_modules/bootstrap-fileinput/js/locales/es.js" type="text/javascript"></script>
    <script src="../../node_modules/bootstrap-fileinput/themes/explorer-fa/theme.js" type="text/javascript"></script>
    <script src="../../node_modules/bootstrap-fileinput/themes/fa/theme.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" type="text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" type="text/javascript"></script>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=41a90b1059ade44d7db374c4db586dfb&libraries=services"></script>
<script type="text/javascript">
var addBtn = $('#addBtn'),
    userType = $('#userType'),
    userNo = $('#userNo'),
    category = $('#category'),
    itemName = $('#itemName'),
    title = $('#title'),
    content = $('#content'),
    startDate = $('#startDate'),
    endDate = $('#endDate'),
    rtIcon = $('#rticon'),
    ldIcon = $('#ldicon'),
    price = $('#price');
var latitude, longitude;
$('header').load('../header.html');
var curDate = moment(new Date()).format('YYYY-MM-DD');;
startDate.attr("min",curDate);
endDate.attr("min",curDate);
/*   $.ajax({
    type: 'POST',
    url: '../../json/auth/loginUser',
    success: (data) => {
        $('#userName').html(data);
        },
    error: () => {
        alert('회원정보 로드 실패!');
    }
});    //end ajax    
  
 */
 
//지도 표시
var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
mapOption = {
center: new daum.maps.LatLng(37.56676, 126.97834), // 지도의 중심좌표
level: 3, // 지도의 확대 레벨
mapTypeId : daum.maps.MapTypeId.ROADMAP // 지도종류
}; 
//지도를 생성한다 
var map = new daum.maps.Map(mapContainer, mapOption); 
//지도 타입 변경 컨트롤을 생성한다
var mapTypeControl = new daum.maps.MapTypeControl();
//지도의 상단 우측에 지도 타입 변경 컨트롤을 추가한다
map.addControl(mapTypeControl, daum.maps.ControlPosition.TOPRIGHT); 
//지도에 확대 축소 컨트롤을 생성한다
var zoomControl = new daum.maps.ZoomControl();
//지도의 우측에 확대 축소 컨트롤을 추가한다
map.addControl(zoomControl, daum.maps.ControlPosition.RIGHT);


//지도 클릭 이벤트 마커생성
daum.maps.event.addListener(map, 'click', function(mouseEvent) {
    // 클릭한 위도, 경도 정보를 가져옵니다
    $('#lat').val(mouseEvent.latLng.getLat());
    $('#lng').val(mouseEvent.latLng.getLng());
    // 마커 위치를 클릭한 위치로 옮깁니다
    marker.setPosition(mouseEvent.latLng);

});

//marker.setMap(null) - (마커삭제)을 사용하기위해 marker변수를 글로벌 변수로 지정
var marker = new daum.maps.Marker();

//위치검색 하면 좌표저장및 마커 찍어줌
$('#submit').click(()=> {
    if ($('#address').val() == "") {
        return swal("주소를 입력하세요!");
    }
    marker.setMap(null);
var geocoder = new daum.maps.services.Geocoder();
   geocoder.addressSearch($('#address').val(),function(result, status) {
       if (result == "") {
           swal("정확한 주소를 입력해주세요");
       }
       var coords = new daum.maps.LatLng(result[0].y, result[0].x);

       // 결과값으로 받은 위치를 마커로 표시합니다
       map.setCenter(coords);
       marker = new daum.maps.Marker({
           map: map,
           position: coords
       });
       
        $('#mapAddr').val(result[0].address_name);
        $('#itemAddr').val(result[0].address_name);
        $('#lat').val(result[0].y);
        $('#lng').val(result[0].x);
        })
});

// 내 주소입력 클릭시 내 회원정보에서 주소 받아오고 위치 찍어줌
$('#myaddr').click(()=> {
    $.ajax("/json/maps/get",{
        type: 'POST',
        dataType: 'json',
        error: () => {
            swal("로그인 회원정보의 주소 정보 로드 실패");
        }
    }).done((result)=> {
        $('#mapAddr').val(result.map.address);
        $('#itemAddr').val(result.map.address);
        $('#lat').val(result.map.latitude);
        $('#lng').val(result.map.longitude);
    marker.setMap(null);
    var loc = new daum.maps.LatLng(result.map.latitude, result.map.longitude);
    map.setCenter(loc);
    marker = new daum.maps.Marker({
        map: map,
        position: loc
    });
    })
})

//등록버튼 클릭이벤트
addBtn.click(() => {
    var payYn = 0;
    if (category.val() == 0) {
        return swal('카테고리를 선택하세요.');
    }
    if (itemName.val() == 0) {
        return swal('물품정보를 입력하세요.');
    }
    if (title.val() == 0) {
        return swal('제목을 입력하세요.');
    }
    if (content.val() == 0) {
        return swal('내용을 입력하세요.');
    }
    if (startDate.val() > endDate.val()) {
        return swal('대여기간을 확인해 주세요.')
    } 
    if (price.val() == 0) {
        return swal('쉐어비용을 입력하세요.')
    }
    if ($('#lat').val() == 0) {
        return swal('위치를 입력하세요')
    }
    if ($('.data-pay:checked').length == 0) {
        return swal('(직거래/안전거래) 최소한 한개 이상 체크하세요');
    }
    $('.data-pay:checked').each(function() {
        payYn += Number(this.value);
    })
    $('#payYn').val(payYn);
    var formData = new FormData($('#formData')[0]);
    $.ajax('/json/item/add', {
        data: formData,
        dataType: 'json',
        method: 'POST',
        processData: false,
        contentType: false,
        success: () => {
            location.href='list.html';
            },
        error: (request,status,error) => {
            swal("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
        }
    }); 
    
    
});


category.on('change',() => {
    if (category.val() != 0) {
        category.removeClass('btn-secondary').addClass('btn-primary');
    } else {
        category.removeClass('btn-primary').addClass('btn-secondary');
    }
});

</script>
<script>
$('#file4').fileinput({
    theme: 'fa',
    
});


</script>

</body>
</html>
    