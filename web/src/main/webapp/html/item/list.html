<!DOCTYPE html>
<html>
<head>
<style>
  .m_pointer{
        cursor: pointer;
      }
</style>
<meta charset="UTF-8">
<style type="text/css">
</style>
<title>리스트</title>
</head>

<body>

<header></header>

            
<div class="album py-5">
    <div class='container'>
<div class="d-flex justify-content-start bd-highlight mb-1">
    <div class="p-2 bd-highlight m_pointer" id="rent"><i class="fa fa-sign-out" style="color:#007BFF;"></i>Rent</div>
    <div class="p-2 bd-highlight m_pointer" id="lend"><i class="fa fa-sign-in" style="color:#007BFF"></i>Lend</div>
    <div onclick="location.href='../item/form.html'" class="p-2 bd-highlight m_pointer"><i class="fa fa-plus-square" style="color:#007BFF"></i>Add</div>
    </div>
        <div id="list" class='row' >
        
        </div>
        
        
   <nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    <li class="page-item">
    <a id="prevBtn" class="page-link" tabindex="-1">이전</a></li>
        
    <li class="page-item"><a id="currBtn" class="page-link" href="#">1</a></li>
    
    <li class="page-item ">
    <a id="nextBtn" class="page-link"  tabindex="0">다음</a></li>
  </ul>
</nav>
        
</div>
</div>

<script id="t1" type="text/x-handlebars-template">
{{#each list}}
    <div style="color: #000 !important; background: #fff0 !important;" class="col-md-3 col-sm-6 col-xs-12 m_pointer" onclick="location.href='view.html?no={{itemNo}}'">
    <div class="card mb-4 box-shadow" >
        <img class="card-img-top" 
            style="height: 225px; width: 100%; display: block;" 
{{#each photos}}
            src="/download/{{thumbnail thumbnailName}}" 
{{/each}}

      

{{#shared status}}
    <img class="card-img-top" style="height: 225px; width: 100%; position:absolute;"src="/images/shared.png">
{{/shared}}
    <div class="card-body"> 
        <h3 class="mb-2">
        <p class="card-text text-truncate" style="text-align: center;">{{title}}</p></h3>
        {{#check userType}}
        <p class="card-text mb-0 text-muted" type="date" style="text-align: right;">{{formatDate startDate}} ~ {{formatDate endDate}}</p>
        {{/check}}
        <p class="card-text mb-0 text-truncate" style="text-align: right;">{{name}}</p>
        <p class="card-text mb-0 text-truncate" style="text-align: right;">{{price}}<i class="fa fa-krw"></i></p>
        <div class="mb-2">
    </div>
    </div>
    </div>
</div>
{{/each}}
</script>

<script src='../../node_modules/handlebars/dist/handlebars.min.js'></script>
<script src='../../node_modules/moment/moment.js'></script>
<script src='../../node_modules/jquery/dist/jquery.min.js'></script>
<script src='../../node_modules/popper.js/dist/umd/popper.min.js'></script>
<script src='../../node_modules/bootstrap/dist/js/bootstrap.min.js'></script>
<script src='../../js/fileupload.js'></script>
<script type="text/javascript">
var prevBtn = $("#prevBtn"),
    currBtn = $("#currBtn"),
    nextBtn = $("#nextBtn"),
    rentBtn = $('#rent'),
    lendBtn = $('#lend'),
    currPageNo = 1,
    userType = 0,
    categoryNo = 0,
    words = "",
    template1Src = $('#t1').html(),
    template1Engine = Handlebars.compile(template1Src);

$('header').load('../header.html');

Handlebars.registerHelper('formatDate', function(date) {
    return  moment(date).format('YYYY-MM-DD');
});
Handlebars.registerHelper('photo', function(photoName) {
    var photos = photoName.split(",");
    return photos[0];
});
Handlebars.registerHelper('thumbnail', function(thumbnailName) {
    var thumbnails = thumbnailName.split(",");
    return thumbnails[0];
});
Handlebars.registerHelper('check', function(userType, options) {
    if (userType == 0){
    return options.fn(this);
    }
});
Handlebars.registerHelper('shared', function(status, options) {
    if (status == 1){
    return options.fn(this);
    }
});
console.log($(location).attr('search').split("=")[0]);
if ($(location).attr('search').split("=")[0] == '?cr') {
    categoryNo = $(location).attr('search').split("=")[1];
} else {
    var searchWord = decodeURI($(location).attr('search')).split("=")[1];
    if (searchWord != undefined) {
    words = searchWord.split("+").join(" ");
    }
}

load(1,0,categoryNo,words);
rentBtn.click(() => {
    /* $('#rent').removeClass('btn-secondary').addClass('btn-primary');
    $('#lend').removeClass('btn-primary').addClass('btn-secondary'); */
    userType = 0;
    load(1,userType)
});
lendBtn.click(() => {
   /*  $('#rent').removeClass('btn-primary').addClass('btn-secondary');
    $('#lend').removeClass('btn-secondary').addClass('btn-primary'); */
    userType = 1;
    load(1,userType);
});

prevBtn.click(() => {
    load(currPageNo - 1, userType, categoryNo, words)
});
nextBtn.click(() => {
    load(currPageNo + 1, userType, categoryNo, words)
});
function load(pageNo, userType, categoryNo, words) {
    /* 
    if (options == undefined) options = {};
    options.pn = pageNo; */
    
    $.ajax('../../json/item/list', {
        
        data: {
            pn: pageNo,
            ut: userType,
            words: words,
            cr: categoryNo
        },
        dataType: 'json',
        success: (result) => {
            console.log(result)
            $('#list').html(template1Engine(result))
            
            currPageNo = result.pageNo;
            currBtn.html(currPageNo);
            
            if (result.pageNo == 1) {
                $(prevBtn.parent()).addClass("disabled");
            } else {
                $(prevBtn.parent()).removeClass("disabled");
            }
            
            if (result.lastPageNo == result.pageNo) {
                $(nextBtn.parent()).addClass("disabled");
            } else{
                $(nextBtn.parent()).removeClass("disabled");
            } 
        },
        
        error: () => {
            window.alert('서버 실행 오류!');
        }
    });
    
}
</script>    
    
      
</body>
</html>