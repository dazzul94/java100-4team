<!DOCTYPE html>
<html>
<head>


<style>
  .m_pointer{
        cursor: pointer;
      }
    </style>
<meta charset="UTF-8">
<style type="text/css">
</style>
<title>리스트</title>
<style>
.hvr-grow-rotate {
  display: inline !important;
}

body {
  padding : 0 0 0 0 !important;
  padding-left : 0 !important;
  padding-right : 0 !important;
  
}

[class^="hvr-"] {
  margin: 0 !important;
  
}

</style>
        <link href="../../node_modules/hover.css/css/demo-page.css" rel="stylesheet" media="all">
        <link href="../../node_modules/hover.css/css/hover.css" rel="stylesheet" media="all">

</head>

<body>

<header></header>
        <div class='container'>
        <div class='row justify-content-md-center'>
        
        <button type="button" id="rent" class="hvr-bob col-sm-4 btn btn-primary" style="height: 50px;">빌려드립니다</button>
            <div class="col-sm-1"></div>
        <button type="button" id="lend" class="hvr-bob col-sm-4 btn btn-secondary" style="height: 50px;">빌려주세요</button>
            
        </div>
        </div>
    
<div class="album py-5">
    <div class='container'>
        <div id="list" class='row' >
        
        </div>
        
        
   <nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    <li class="page-item">
    <a id="prevBtn" class="page-link" tabindex="-1">이전</a></li>
        
    <li class="page-item"><a id="currBtn" class="page-link" href="#">1</a></li>
    
    <li class="page-item ">
    <a id="nextBtn" class="page-link"  tabindex="0">다음</a></li>
  </ul>
</nav>
        
</div>
</div>

<script id="t1" type="text/x-handlebars-template">
{{#each list}}
    <div style="color: #000 !important; background: #fff0 !important;" class="hvr-grow-rotate col-md-4 col-sm-6 col-xs-12 m_pointer" onclick="location.href='view.html?no={{itemNo}}'">
    <div class="card mb-4 box-shadow" >
        <img class="card-img-top" 
            style="height: 225px; width: 100%; display: block;" 
{{#each photos}}
            src="/download/{{thumbnail thumbnailName}}" 
{{/each}}
      >
    <div class="card-body"> 
        <h3 class="mb-0">
        <p class="card-text text-truncate">{{title}}</p></h3>
        {{#check userType}}
        <p class="card-text mb-1 text-muted" type="date">{{formatDate startDate}} ~ {{formatDate endDate}}</p>
        {{/check}}
        <p class="card-text text-truncate">{{name}}</p>
        <p class="card-text text-truncate">{{content}}</p>
        <div class="d-flex justify-content-between align-items-center">
    </div>
    </div>
    </div>
</div>
{{/each}}
</script>

<script src='../../node_modules/handlebars/dist/handlebars.min.js'></script>
<script src='../../node_modules/moment/moment.js'></script>
<script src='../../node_modules/jquery/dist/jquery.min.js'></script>
<script src='../../node_modules/popper.js/dist/umd/popper.min.js'></script>
<script src='../../node_modules/bootstrap/dist/js/bootstrap.min.js'></script>
<script src='../../js/fileupload.js'></script>
<script type="text/javascript">
var prevBtn = $("#prevBtn"),
    currBtn = $("#currBtn"),
    nextBtn = $("#nextBtn"),
    rentBtn = $('#rent'),
    lendBtn = $('#lend'),
    currPageNo = 1,
    userType = 0,
    categoryNo = 0,
    words = "",
    template1Src = $('#t1').html(),
    template1Engine = Handlebars.compile(template1Src);

$('header').load('../header.html');

Handlebars.registerHelper('formatDate', function(date) {
    return  moment(date).format('YYYY-MM-DD');
});
Handlebars.registerHelper('photo', function(photoName) {
    var photos = photoName.split(",");
    return photos[0];
});
Handlebars.registerHelper('thumbnail', function(thumbnailName) {
    var thumbnails = thumbnailName.split(",");
    return thumbnails[0];
});
Handlebars.registerHelper('check', function(userType, options) {
    if (userType == 0){
    return options.fn(this);
    }
});
console.log($(location).attr('search').split("=")[0]);
if ($(location).attr('search').split("=")[0] == '?cr') {
    categoryNo = $(location).attr('search').split("=")[1];
} else {
	var searchWord = decodeURI($(location).attr('search')).split("=")[1];
	if (searchWord != undefined) {
	words = searchWord.split("+").join(" ");
	}
}

load(1,0,categoryNo,words);
rentBtn.click(() => {
    $('#rent').removeClass('btn-secondary').addClass('btn-primary');
    $('#lend').removeClass('btn-primary').addClass('btn-secondary');
    userType = 0;
    load(1,userType)
});
lendBtn.click(() => {
    $('#rent').removeClass('btn-primary').addClass('btn-secondary');
    $('#lend').removeClass('btn-secondary').addClass('btn-primary');
    userType = 1;
    load(1,userType);
});
prevBtn.click(() => {
    load(currPageNo - 1, userType, categoryNo, words)
});
nextBtn.click(() => {
    load(currPageNo + 1, userType, categoryNo, words)
});
function load(pageNo, userType, categoryNo, words) {
    /* 
    if (options == undefined) options = {};
    options.pn = pageNo; */
    
    $.ajax('../../json/item/list', {
        
        data: {
            pn: pageNo,
            ut: userType,
            words: words,
            cr: categoryNo
        },
        dataType: 'json',
        success: (result) => {
            console.log(result)
            $('#list').html(template1Engine(result))
            
            currPageNo = result.pageNo;
            currBtn.html(currPageNo);
            
            if (result.pageNo == 1) {
                $(prevBtn.parent()).addClass("disabled");
            } else {
                $(prevBtn.parent()).removeClass("disabled");
            }
            
            if (result.lastPageNo == result.pageNo) {
                $(nextBtn.parent()).addClass("disabled");
            } else{
                $(nextBtn.parent()).removeClass("disabled");
            } 
        },
        
        error: () => {
            window.alert('서버 실행 오류!');
        }
    });
    
}
</script>    
    
      
</body>
</html>