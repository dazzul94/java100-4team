<!DOCTYPE html>
<html class="no-js">
<head>
<link href="../../css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="../../css/main.css">
<link rel="stylesheet" type="text/css" href="/css/jquery-ui.min.css">
<meta charset="UTF-8">
<style type="text/css">
.no-js {display:none;}
</style>
<title>리스트</title>

<style type="text/css">



#banner {
overflow: hidden;
height: 100%;
}
.sample_image { overflow: hidden; }
.sample_image  img {
    -webkit-transform:scale(1);
    -moz-transform:scale(1);
    -ms-transform:scale(1); 
    -o-transform:scale(1);  
    transform:scale(1);
    -webkit-transition:.3s;
    -moz-transition:.3s;
    -ms-transition:.3s;
    -o-transition:.3s;
    transition:.3s;
}
.sample_image:hover img {
    -webkit-transform:scale(1.1);
    -moz-transform:scale(1.1);
    -ms-transform:scale(1.1);   
    -o-transform:scale(1.1);
    transform:scale(1.1);
}
</style>

</head>

<body onLoad="runSlideShow()">
<header></header>
<div id ="dropdownSearch" style="text-align: center;cursor:pointer;"><img title="상세검색" src="/images/search.png">
<span><b>상세검색</b></span>
</div>

<div id="searchDiv" style="width:600px;margin:auto;display:none;">
<!-- 슬라이더 묶음 -->
<div>
<div style="display: inline-block;margin:20px;width:220px;">
<div id="distanceSlide"></div><div id="distanceValue" style="text-align:center;"></div>
</div >
<div style="display: inline-block;margin:20px;width:270px;">
<div id="priceSlide"></div><div id="priceValue" style="text-align:center;"></div>
</div>
</div>
<!-- 정렬쪽 묶음 -->
<div>
<span style="margin:0 5px 0 50px;">거래 가능 상품만 보기</span><input id="dealEnd" type="checkbox">
<select id='category' style="margin:20px;" class="btn btn-secondary data-reset">
                            <option value=0>카테고리</option>
                            <option value=1>전자제품</option>
                            <option value=2>뷰티/악세</option>
                            <option value=3>의류</option>
                            <option value=4>공구</option>
                            <option value=5>ETC</option>
</select>
<select id='order' style="margin:20px;" class="btn btn-secondary data-reset">
                            <option value=0>정렬</option>
                            <option value=1>거리오름차순</option>
                            <option value=2>거리내림차순</option>
                            <option value=3>가격오름차순</option>
                            <option value=4>가격내림차순</option>
</select>
</div>

<div style="margin:20px auto;width:400px;">
<input id="words" class="form-control" type="search"  style="width:150px;display:inline-block;margin:0 50px 0 30px;"
                    name='words' placeholder="&#xf002" aria-label="Search">
<button id="detailSearch" type="button" class="btn">검색하기</button>
</div>
</div>
<div><img id ="foldSearch" title="접기" src="/images/arrowup.png" style="display:block;margin:0 auto;cursor:pointer;"></div>
<div id="banner" style="overflow: hidden;">


</div>

<div class="album py-3">
    <div class='container'>
    
  
        <div id="list" class='row'  style="position: relative;">
        
        </div>
        
<div style="text-align: center;cursor:pointer;">
<img id="lastPage" src="/images/more.png">
</div>

</div>
</div>
<script id="t1" type="text/x-handlebars-template">
{{#each list}}
    <div style="color: #000 !important; background: #fff0 !important;" class="col-md-3 col-sm-6 col-xs-12 m_pointer" onclick="location.href='view.html?no={{itemNo}}'">
    <div class="card mb-4 box-shadow">
    <div class="sample_image">
        <img class="card-img-top" 
            style="height: 225px; width: 100%; display: block;" 
{{#each photos}}
            src="/download/{{thumbnail thumbnailName}}"></div> 
{{/each}}

      

{{#shared status}}
    <img class="card-img-top" style="height: 50px; width: 200px; margin:90px 0 0 30px; position:absolute;"src="/images/shared.png">
{{/shared}}
    <div class="card-body px-0 py-0"> 
        <h3 class="mb-2 mx-3">
        <p class="card-text text-truncate">{{title}}</p></h3>
        <p class="card-text mb-0 mx-3 text-truncate text-muted">{{itemName}}</p>
        <p class="card-text mb-0 mx-3 text-truncate text-muted">{{fb price}} 원</p>
        <div class="mb-2">
    </div>
    </div>
    </div>
</div>
{{/each}}
</script>

        <!-- <p class="card-text mb-0 mx-3 text-muted" type="date" style="text-align: right;">{{formatDate startDate}} ~ {{formatDate endDate}}</p>
        <p class="card-text mb-0 mx-3 text-truncate text-muted" style="text-align: right;">{{cty category}}</p>
        <p class="card-text mb-0 mx-3 text-truncate text-muted" style="text-align: right;">{{distance}}Km</p> -->

<script src="https://ssl.daumcdn.net/dmaps/map_js_init/postcode.v2.js"></script>
<script src='../../node_modules/handlebars/dist/handlebars.min.js'></script>
<script src='../../node_modules/moment/moment.js'></script>
<script src='../../node_modules/jquery/dist/jquery.min.js'></script>
<script src='../../node_modules/popper.js/dist/umd/popper.min.js'></script>
<script src='../../node_modules/bootstrap/dist/js/bootstrap.min.js'></script>
<script src="//developers.kakao.com/sdk/js/kakao.min.js"></script>
<script src="https://static.nid.naver.com/js/naveridlogin_js_sdk_2.0.0.js" charset="utf-8"></script>
<script src='../../js/fileupload.js'></script>
<script src='/js/jquery-ui.min.js'></script>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=41a90b1059ade44d7db374c4db586dfb&libraries=services"></script>
<script> 
$('#foldSearch').hide();
//검색바 드롭다운
$("#dropdownSearch").click(()=>{
    $('#lastPage').attr("src","/images/more.png");
    $.getJSON("/json/auth/loginUser",(result)=> {
        if (result.status == "fail") {
            return swal("상세검색을 원하시면 로그인 해주세요");
        } else {
            $('#searchDiv').show();
            $('#dropdownSearch').hide();
            $('#foldSearch').show();
        }
    })
    
})
$("#foldSearch").click(()=>{
    $('#searchDiv').hide();
    $('#dropdownSearch').show();
    $('#foldSearch').hide();
})



var slideShowSpeed = 3000 
var crossFadeDuration = 2 
var Pic = new Array() 
    Pic[0] = '../../images/main01.jpg' 
    Pic[1] = '../../images/main02.jpg' 
    Pic[2] = '../../images/main03.jpg' 
    Pic[3] = '../../images/main04.jpg' 
    Pic[4] = '../../images/main05.jpg' 
    Pic[5] = '../../images/main06.jpg' 
 
var t 
var j = 0 
var p = Pic.length 

var preLoad = new Array() 
for (i = 0; i < p; i++){ 
    preLoad[i] = new Image() 
    preLoad[i].src = Pic[i] 
} 

function runSlideShow(){ 
  if (document.all){ 
      document.images.SlideShow.style.filter="blendTrans(duration=2)" 
      document.images.SlideShow.style.filter="blendTrans(duration=crossFadeDuration)" 
      document.images.SlideShow.filters.blendTrans.Apply() 
  } 
  document.images.SlideShow.src = preLoad[j].src 
  if (document.all){ 
      document.images.SlideShow.filters.blendTrans.Play() 
  } 
  j = j + 1 
  if (j > (p-1)) j=0 
  t = setTimeout('runSlideShow()', slideShowSpeed) 
} 

</script> 
<script type="text/javascript">
var prevBtn = $("#prevBtn"),
    currBtn = $("#currBtn"),
    nextBtn = $("#nextBtn"),
    rentBtn = $('#rent'),
    lendBtn = $('#lend'),
    rentIcon = $('#renticon'),
    lendIcon = $('#lendicon'),
    currPageNo = 1,
    categoryNo = 0,
    words = "",
    pageNo = 1,
    dealEnd, priceStart, priceEnd, distance, order, align, lastPage,
    template1Src = $('#t1').html(),
    template1Engine = Handlebars.compile(template1Src);


//test
$(window).scroll( function() {
    if ($(window).scrollTop() == $(document).height() - $(window).height()) {
        pageNo = pageNo + 1;
        if (lastPage != 1) {
        //ajax
        $.ajax('/json/item/list', {
            data: {
                pn: pageNo, 
                words: words,
                cr: categoryNo,
                distance: distance,
                price1: priceStart,
                price2: priceEnd,
                dealEnd: dealEnd,
                oc: order,
                al: align
                  },
            dataType: 'json',
            success: (result) => {
                if (result.list == "") {
                    lastPage = 1;
                    $('#lastPage').attr("src","/images/end.png");
                } else {
                $('#list').append(template1Engine(result))
                }
                  },
            
            error: () => {
                swal('서버 실행 오류!');
                   }
        });
        }

        
        // ajax를 추가해서 목록을 받아온다
        
    }
});



//상세버튼 클릭시
$('#detailSearch').click(function() {
    pageNo = 1;
    lastPage = 0;
    categoryNo = $('#category').val();
    if ($('#dealEnd').prop("checked")) {
        dealEnd = 1;
    } else {
        dealEnd = 6;
    }
    words = $('#words').val()
    switch ($('#order').val()) {
    case '1' : 
        order = 'distance';
        align = 'asc';
        break;
    case '2' : 
        order = 'distance';
        align = 'desc';
        break;
    case '3' :
        order = 'price';
        align = 'asc';
        break;
    case '4' : 
        order = 'price';
        align = 'desc';
        break;
    default : 
        order = null;
        align = null;
    }
    load(pageNo, categoryNo, words, dealEnd, priceStart, priceEnd, distance, order, align);
    
})

//검색슬라이더
$( function() {
    $( "#distanceSlide" ).slider({min:0,max:500,value:500,create: function() {
        $("#distanceValue").text("위치 범위 : "+$( this ).slider( "value" )+"Km" );
        distance = $( this ).slider( "value" );
    },
    slide: function( event, ui ) {
        $("#distanceValue").text("위치 범위 : "+ ui.value+"Km" );
        distance = ui.value;
    }});
    
    $( "#priceSlide" ).slider({min:0,max:100000,values:[0,100000],range:true,step:10000,create: function() {
        $("#priceValue").text("가격 범위 : "+$( this ).slider( "values", 0 ) +"원 ~ "+$( this ).slider( "values", 1 )+"원" );
        priceStart = $( this ).slider( "values", 0 );
        priceEnd = $( this ).slider( "values", 1 );
    },
    slide: function( event, ui ) {
        $("#priceValue").text("가격 범위 : "+ui.values[0] +"원 ~ "+ui.values[1]+"원" );
        priceStart = ui.values[0];
        priceEnd = ui.values[1];
    }});
  } );
load(1,0);
$('header').load('../header.html')

$("#shared_img").mouseover(function(){ 
    $(this).prev().children().mouseover();    
})

/* var btn1 = document.querySelector('#shared_img')
var btn2 = document.querySelector('#sample_image')
btn1.addEventListener('hover', function(event) {
  var me = new MouseEvent('hover')
  btn2.dispatchEvent(me)
}); */


Handlebars.registerHelper('fb', function(price) {
    var len, point, str, price;

    price = price + "";
    point = price.length % 3 ;
    len = price.length;

    str = price.substring(0, point);
    while (point < len) {
       if (str != "") str += ",";
       str += price.substring(point, point + 3);
       point += 3;
    }

    return str;
});

Handlebars.registerHelper('formatDate', function(date) {
    return  moment(date).format('YYYY-MM-DD');
});
Handlebars.registerHelper('photo', function(photoName) {
    var photos = photoName.split(",");
    return photos[0];
});
Handlebars.registerHelper('thumbnail', function(thumbnailName) {
    var thumbnails = thumbnailName.split(",");
    return thumbnails[0];
});
Handlebars.registerHelper('shared', function(status, options) {
    if (status >= 1){
    return options.fn(this);
    }
});
Handlebars.registerHelper("cty", function(category) {
    if(category == 1){ return "전자";}
    if(category == 2){ return "뷰티";}
    if(category == 3){ return "의류";}
    if(category == 4){ return "공구";}
    if(category == 5){ return "ETC";}
});

rentBtn.click(() => {
    $('#renticon').css('color', '#007BFF');
    $('#lendicon').css('color', 'grey');
    load(1,categoryNo,words)
});

prevBtn.click(() => {
    load(currPageNo - 1, categoryNo, words)
});
nextBtn.click(() => {
    load(currPageNo + 1,  categoryNo, words)
});

function load(pageNo, categoryNo, words, dealEnd, priceStart, priceEnd, distance, order, align) {
    lastPage = 0;
    $.ajax('../../json/item/list', {
        data: {
            pn: pageNo, 
            words: words,
            cr: categoryNo,
            distance: distance,
            price1: priceStart,
            price2: priceEnd,
            dealEnd: dealEnd,
            oc: order,
            al: align
        },
        dataType: 'json',
        success: (result) => {
            
            $('#list').html(template1Engine(result))
            
        },
        
        error: () => {
            window.alert('서버 실행 오류!');
        }
    });
    
}

$(function(){
    $('html').removeClass("no-js");
})

/* $('#banner').load('../main/banner.html'); */ 
</script>    
    
      
</body>
</html>