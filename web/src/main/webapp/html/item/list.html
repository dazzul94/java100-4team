<!DOCTYPE html>
<html>
<head>

<meta charset="UTF-8">
<style type="text/css">
</style>
<title>리스트</title>

<style type="text/css">
#banner {
overflow: hidden;
height: 100%;

}



</style>

</head>

<body onLoad="runSlideShow()">
<header></header>
<div id="banner" style="overflow: hidden;">


</div>

<div class="album py-3">

    <div class='container'>
<div class="d-flex justify-content-start bd-highlight mb-3">
    <div class="p-2 bd-highlight m_pointer mx-auto" id="rent">
    <i id="renticon" class="fa fa-sign-out" style="color:#007BFF;font-size:36px;"></i>
    <h3 style="display: inline-block;"><span>Rent</span></h3></div>
    <div class="p-2 bd-highlight m_pointer mx-auto" id="lend">
    <i id="lendicon" class="fa fa-sign-in" style="color:grey;font-size:36px;"></i>
    <h3 style="display: inline-block;"><span>Lend</span></h3></div>
    </div>
  
        <div id="list" class='row'  style="position: relative;">
        
        </div>
        
        
   <nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    <li class="page-item">
    <a id="prevBtn" class="page-link" tabindex="-1"><i class="fa fa-chevron-left"></i></a></li>
        
    <li class="page-item"><a id="currBtn" class="page-link" href="#">1</a></li>
    
    <li class="page-item ">
    <a id="nextBtn" class="page-link"  tabindex="0"><i class="fa fa-chevron-right"></i></a></li>
  </ul>
</nav>
        
</div>
</div>

<script id="t1" type="text/x-handlebars-template">
{{#each list}}
    <div style="color: #000 !important; background: #fff0 !important;" class="col-md-3 col-sm-6 col-xs-12 m_pointer" onclick="location.href='view.html?no={{itemNo}}'">
    <div class="card mb-4 box-shadow" >
        <img class="card-img-top" 
            style="height: 225px; width: 100%; display: block;" 
{{#each photos}}
            src="/download/{{thumbnail thumbnailName}}"> 
{{/each}}

      

{{#shared status}}
    <img class="card-img-top" style="height: 225px; width: 100%; position:absolute;"src="/images/shared.png">
{{/shared}}
    <div class="card-body"> 
        <h3 class="mb-2 mx-3">
        <p class="card-text text-truncate" style="text-align: center;">{{title}}</p></h3>
        {{#check userType}}
        <p class="card-text mb-0 mx-3 text-truncate text-muted" style="text-align: right;">{{name}}</p>
        <p class="card-text mb-0 mx-3 text-muted" type="date" style="text-align: right;">{{formatDate startDate}} ~ {{formatDate endDate}}</p>
        {{/check}}
        <p class="card-text mb-0 mx-3 text-truncate text-muted" style="text-align: right;">{{fb price}}<i class="fa fa-krw"></i></p>
        <div class="mb-2">
    </div>
    </div>
    </div>
</div>
{{/each}}
</script>

<script src='../../node_modules/handlebars/dist/handlebars.min.js'></script>
<script src='../../node_modules/moment/moment.js'></script>
<script src='../../node_modules/jquery/dist/jquery.min.js'></script>
<script src='../../node_modules/popper.js/dist/umd/popper.min.js'></script>
<script src='../../node_modules/bootstrap/dist/js/bootstrap.min.js'></script>
<script src='../../js/fileupload.js'></script>
<script> 
var slideShowSpeed = 3000 
var crossFadeDuration = 2 
var Pic = new Array() 
    Pic[0] = '../../images/main01.jpg' 
    Pic[1] = '../../images/main02.jpg' 
    Pic[2] = '../../images/main03.jpg' 
    Pic[3] = '../../images/main04.jpg' 
    Pic[4] = '../../images/main05.jpg' 
    Pic[5] = '../../images/main06.jpg' 
 
var t 
var j = 0 
var p = Pic.length 

var preLoad = new Array() 
for (i = 0; i < p; i++){ 
    preLoad[i] = new Image() 
    preLoad[i].src = Pic[i] 
} 

function runSlideShow(){ 
  if (document.all){ 
      document.images.SlideShow.style.filter="blendTrans(duration=2)" 
      document.images.SlideShow.style.filter="blendTrans(duration=crossFadeDuration)" 
      document.images.SlideShow.filters.blendTrans.Apply() 
  } 
  document.images.SlideShow.src = preLoad[j].src 
  if (document.all){ 
      document.images.SlideShow.filters.blendTrans.Play() 
  } 
  j = j + 1 
  if (j > (p-1)) j=0 
  t = setTimeout('runSlideShow()', slideShowSpeed) 
} 




</script> 
<script type="text/javascript">

var prevBtn = $("#prevBtn"),
    currBtn = $("#currBtn"),
    nextBtn = $("#nextBtn"),
    rentBtn = $('#rent'),
    lendBtn = $('#lend'),
    rentIcon = $('#renticon'),
    lendIcon = $('#lendicon'),
    currPageNo = 1,
    userType = 0,
    categoryNo = 0,
    words = "",
    template1Src = $('#t1').html(),
    template1Engine = Handlebars.compile(template1Src);

$('header').load('../header.html');


Handlebars.registerHelper('fb', function(price) {
    var len, point, str, price;

    price = price + "";
    point = price.length % 3 ;
    len = price.length;

    str = price.substring(0, point);
    while (point < len) {
       if (str != "") str += ",";
       str += price.substring(point, point + 3);
       point += 3;
    }

    return str;
});

Handlebars.registerHelper('formatDate', function(date) {
    return  moment(date).format('YYYY-MM-DD');
});
Handlebars.registerHelper('photo', function(photoName) {
    var photos = photoName.split(",");
    return photos[0];
});
Handlebars.registerHelper('thumbnail', function(thumbnailName) {
    var thumbnails = thumbnailName.split(",");
    return thumbnails[0];
});
Handlebars.registerHelper('check', function(userType, options) {
    if (userType == 0){
    return options.fn(this);
    }
});
Handlebars.registerHelper('shared', function(status, options) {
    if (status == 1){
    return options.fn(this);
    }
});
console.log($(location).attr('search').split("=")[0]);
if ($(location).attr('search').split("=")[0] == '?cr') {
    categoryNo = $(location).attr('search').split("=")[1];
} else {
    var searchWord = decodeURI($(location).attr('search')).split("=")[1];
    if (searchWord != undefined) {
    words = searchWord.split("+").join(" ");
    }
}

load(1,0,categoryNo,words);
rentBtn.click(() => {
    $('#renticon').css('color', '#007BFF');
    $('#lendicon').css('color', 'grey');
    userType = 0;
    load(1,userType,categoryNo)
});
lendBtn.click(() => {
    $('#renticon').css('color', 'grey');
    $('#lendicon').css('color', '#007BFF'); 
    userType = 1;
    load(1,userType,categoryNo);
});

prevBtn.click(() => {
    load(currPageNo - 1, userType, categoryNo, words)
});
nextBtn.click(() => {
    load(currPageNo + 1, userType, categoryNo, words)
});
function load(pageNo, userType, categoryNo, words) {
    /* 
    if (options == undefined) options = {};
    options.pn = pageNo; */
    
    $.ajax('../../json/item/list', {
        
        data: {
            pn: pageNo,
            ut: userType,
            words: words,
            cr: categoryNo
        },
        dataType: 'json',
        success: (result) => {
            console.log(result)
            $('#list').html(template1Engine(result))
            
            currPageNo = result.pageNo;
            currBtn.html(currPageNo);
            
            if (result.pageNo == 1) {
                $(prevBtn.parent()).addClass("disabled");
            } else {
                $(prevBtn.parent()).removeClass("disabled");
            }
            
            if (result.lastPageNo == result.pageNo) {
                $(nextBtn.parent()).addClass("disabled");
            } else{
                $(nextBtn.parent()).removeClass("disabled");
            } 
        },
        
        error: () => {
            window.alert('서버 실행 오류!');
        }
    });
    
}

$('#banner').load('../main/banner.html');
</script>    
    
      
</body>
</html>