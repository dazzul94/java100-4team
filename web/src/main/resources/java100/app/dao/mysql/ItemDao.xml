<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="java100.app.dao.ItemDao">
    <resultMap type="item" id="itemMap">
        <id column="it_no" property="itemNo"/>
        <result column="ur_no" property="userNo"/>
        <result column="category" property="category"/>
        <result column="user_type" property="userType"/>
        <result column="name" property="name"/>
        <result column="title" property="title"/>
        <result column="cnt" property="content"/>
        <result column="start" property="startDate"/>
        <result column="end" property="endDate"/>
        <result column="price" property="price"/>
        <result column="price_day" property="pricePerDay"/>
        <result column="status" property="status"/>
        
        <association property="writer" javaType="user">
            <id     column="ur_no"       property="userNo"/>
        </association>
        
        <collection property="photos"  ofType="Photo">
            <id     column="pho_no"       property="no"/>
            <result column="it_no"   property="itemNo"/>
            <result column="ur_no"   property="userNo"/>
            <result column="pho_name"   property="photoName"/>
            
        </collection>
        
    </resultMap>
    
    <insert id="insert" parameterType="item" 
        useGeneratedKeys="true" keyColumn="it_no" keyProperty="itemNo">
        insert into item(ur_no,category,user_type,title,name,cnt,start,end,price,price_day,status) 
        values(#{userNo},#{category},#{userType},#{title},#{name},#{content},#{startDate},
                #{endDate},#{price},#{pricePerDay},#{status})
    </insert>
    <select id="findAll" resultMap="itemMap">
        select 
            i.it_no, i.ur_no, i.category, i.user_type, i.name, 
            i.title, i.cnt, i.start, i.end,
            i.price, i.price_day, i.status,
            u.ur_no,
            p.pho_no as pho_no,
            p.it_no as it_no,
            p.ur_no as ur_no,
            p.pho_name as pho_name
            from item as i
            join user as u on i.ur_no=u.ur_no
            left join itemphoto as p on i.it_no=p.it_no
    </select>
    
    <select id="findByNo" resultMap="itemMap" parameterType="int">
        select
            u.ur_no,
            i.it_no,
            i.name,
            i.start,
            i.end,
            i.price,
            i.price_day
         from item i join user u on u.ur_no=i.it_no where i.it_no=#{value}
    </select>

</mapper>









